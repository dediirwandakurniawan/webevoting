{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/router\";\nimport { Button, Modal, ModalHeader, ModalBody, ModalFooter, Form, FormGroup, Label, Input, Card, CardBody } from \"reactstrap\";\nimport DataTable from \"react-data-table-component\";\nimport axios from \"axios\";\nimport Swal from \"sweetalert2\";\nimport Cookies from \"universal-cookie\";\n\nconst TableCalon = () => {\n  const {\n    0: modal,\n    1: setModal\n  } = useState(false);\n  const {\n    0: selectedData,\n    1: setSelectedData\n  } = useState(null);\n  const {\n    0: namaKandidat,\n    1: setNamaKandidat\n  } = useState(\"\");\n  const {\n    0: fotoKandidat,\n    1: setfotoKandidat\n  } = useState(null);\n  const {\n    0: dataCandidate,\n    1: setCandidateDetail\n  } = useState([]);\n  const {\n    0: action,\n    1: setAction\n  } = useState(\"create\");\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: perPage,\n    1: setPerPage\n  } = useState(10);\n  const {\n    0: currentPage,\n    1: setCurrentPage\n  } = useState(1);\n  const {\n    0: totalRows,\n    1: setTotalRows\n  } = useState(0);\n  const {\n    0: id,\n    1: setId\n  } = useState(null);\n  const cookies = new Cookies();\n  useEffect(() => {\n    getCandidate();\n  }, [currentPage, perPage]);\n  const router = useRouter();\n  const eventId = router.query.eventId;\n\n  const getCandidate = async () => {\n    setLoading(true);\n    const {\n      data: res\n    } = await axios.get(`${process.env.NEXT_PUBLIC_URL}/candidate/${eventId}/?page=${currentPage}&size=${perPage}`);\n    setTotalRows(res.data.totalData);\n    setCandidateDetail(res.data.content);\n    setLoading(false);\n  };\n\n  const toggle = () => setModal(!modal);\n\n  const columnCalon = [{\n    name: \"Nama\",\n    selector: row => row.candidate_name\n  }, {\n    name: \"Foto\",\n    cell: row => /*#__PURE__*/_jsx(\"img\", {\n      src: row.photo_url,\n      alt: row.photo_url,\n      style: {\n        width: \"50px\"\n      }\n    })\n  }, {\n    name: \"Action\",\n    cell: row => /*#__PURE__*/_jsxs(_Fragment, {\n      children: [/*#__PURE__*/_jsx(Button, {\n        onClick: () => handleEditForm(row.id),\n        color: \"primary\",\n        size: \"sm\",\n        children: \"Edit\"\n      }), /*#__PURE__*/_jsx(Button, {\n        onClick: () => handleDelete(row.id),\n        color: \"danger\",\n        size: \"sm\",\n        children: \"Hapus\"\n      })]\n    })\n  }];\n\n  let handleTambah = () => {\n    setAction(\"create\");\n    setModal(true);\n  };\n\n  const handleEditForm = async id => {\n    setAction(\"update\");\n    setId(id);\n    await axios.get(`${process.env.NEXT_PUBLIC_URL}/candidate/detail/${id}`, {\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${cookies.get(\"token\")}`\n      }\n    }).then(res => {\n      let data = res.data.data;\n      setNamaKandidat(data.candidate_name);\n      setModal(true);\n    }).catch(e => {\n      Swal.fire({\n        icon: \"error\",\n        title: \"Terjadi Kesalahan!\",\n        text: e\n      });\n    });\n  };\n\n  const handleDelete = id => {\n    Swal.fire({\n      title: \"Hapus Calon?\",\n      text: \"Data yang telah dihapus tidak dapat dikembalikan!\",\n      icon: \"warning\",\n      showCancelButton: true,\n      confirmButtonColor: \"#3085d6\",\n      cancelButtonColor: \"#d33\",\n      confirmButtonText: \"Hapus!\"\n    }).then(result => {\n      if (result.isConfirmed) {\n        axios.delete(`${process.env.NEXT_PUBLIC_URL}/candidate/${id} `, {\n          headers: {\n            Authorization: `Bearer ${cookies.get(\"token\")}`\n          }\n        }).then(res => {\n          Swal.fire({\n            icon: \"success\",\n            title: \"Berhasil\",\n            text: \"Data Berhasil Dihapus !\"\n          });\n          getCandidate();\n        });\n      }\n    });\n  };\n\n  const handleSubmitEvent = async () => {\n    let formData = new FormData(); //formdata object\n\n    formData.append(\"image\", fotoKandidat);\n    formData.append(\"candidate_name\", namaKandidat);\n\n    if (action === \"create\") {\n      await axios.post(`${process.env.NEXT_PUBLIC_URL}/candidate/${eventId}`, formData, {\n        headers: {\n          // \"Content-Type\": \"application/json\",\n          \"Content-Type\": \"multipart/form-data\",\n          Authorization: `Bearer ${cookies.get(\"token\")}`\n        }\n      }).then(res => {\n        Swal.fire({\n          icon: \"success\",\n          title: \"Berhasil\",\n          text: \"Data Berhasil Disimpan !\"\n        });\n        setModal(false);\n        getCandidate();\n      }).catch(e => {\n        console.log(e);\n\n        if (e.response.data.error_messages) {\n          Swal.fire({\n            icon: \"error\",\n            title: \"Terjadi Kesalahan!\",\n            text: e.response.data.error_messages[0].msg\n          });\n        } else {\n          Swal.fire({\n            icon: \"error\",\n            title: \"Terjadi Kesalahan!\",\n            text: e\n          });\n        }\n      });\n    } else {\n      await axios.put(`${process.env.NEXT_PUBLIC_URL}/candidate/${id}`, formData, {\n        headers: {\n          // \"Content-Type\": \"application/json\",\n          \"Content-Type\": \"multipart/form-data\",\n          Authorization: `Bearer ${cookies.get(\"token\")}`\n        }\n      }).then(res => {\n        Swal.fire({\n          icon: \"success\",\n          title: \"Berhasil\",\n          text: \"Data Berhasil Diupdate !\"\n        });\n        setModal(false);\n        getCandidate();\n      }).catch(e => {\n        console.log(e);\n\n        if (e.response.data.error_messages) {\n          Swal.fire({\n            icon: \"error\",\n            title: \"Terjadi Kesalahan!\",\n            text: e.response.data.error_messages[0].msg\n          });\n        } else {\n          Swal.fire({\n            icon: \"error\",\n            title: \"Terjadi Kesalahan!\",\n            text: e\n          });\n        }\n      });\n    }\n  };\n\n  let onClosedModal = () => {\n    setId(null);\n    setNamaKandidat(\"\");\n    setfotoKandidat(\"\");\n  };\n\n  let handleChange = (e, field) => {\n    if (field === \"kandidat\") {\n      setNamaKandidat(e.target.value);\n    } else if (field === \"foto\") {\n      setfotoKandidat(e.target.files[0]);\n    } else {\n      Swal.fire({\n        icon: \"error\",\n        title: \"Oops...\",\n        text: \"Something went wrong!\"\n      });\n    }\n  };\n\n  const handlePageChange = page => {\n    setCurrentPage(page);\n  };\n\n  const handlePerRowsChange = async (newPerPage, page) => {\n    setPerPage(newPerPage);\n  };\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(Card, {\n      className: \"mt-2 mb-2\",\n      color: \"secondary\",\n      children: /*#__PURE__*/_jsx(CardBody, {\n        children: /*#__PURE__*/_jsx(Button, {\n          color: \"primary\",\n          onClick: () => handleTambah(true),\n          children: \"Tambah\"\n        })\n      })\n    }), /*#__PURE__*/_jsx(DataTable, {\n      columns: columnCalon,\n      data: dataCandidate,\n      pagination: true,\n      paginationServer: true,\n      progressPending: loading,\n      paginationTotalRows: totalRows,\n      paginationDefaultPage: currentPage,\n      onChangeRowsPerPage: handlePerRowsChange,\n      onChangePage: handlePageChange\n    }), /*#__PURE__*/_jsxs(Modal, {\n      isOpen: modal,\n      toggle: toggle,\n      onClosed: onClosedModal,\n      children: [/*#__PURE__*/_jsx(ModalHeader, {\n        toggle: toggle,\n        children: action === \"create\" ? \"Tambah Calon\" : \"Edit Calon\"\n      }), /*#__PURE__*/_jsx(ModalBody, {\n        children: /*#__PURE__*/_jsxs(Form, {\n          children: [/*#__PURE__*/_jsxs(FormGroup, {\n            children: [/*#__PURE__*/_jsx(Label, {\n              for: \"namaKandidat\",\n              children: \"Nama Calon\"\n            }), /*#__PURE__*/_jsx(Input, {\n              id: \"namaKandidat\",\n              name: \"nama\",\n              placeholder: \"Nama Calon\",\n              type: \"text\",\n              value: namaKandidat,\n              onChange: e => handleChange(e, \"kandidat\")\n            })]\n          }), /*#__PURE__*/_jsxs(FormGroup, {\n            children: [/*#__PURE__*/_jsx(Label, {\n              for: \"fotoKandidat\",\n              children: \"Foto Calon\"\n            }), /*#__PURE__*/_jsx(Input, {\n              id: \"fotoKandidat\",\n              name: \"foto\",\n              type: \"file\",\n              onChange: e => handleChange(e, \"foto\")\n            })]\n          })]\n        })\n      }), /*#__PURE__*/_jsx(ModalFooter, {\n        children: /*#__PURE__*/_jsx(Button, {\n          color: \"primary\",\n          onClick: () => handleSubmitEvent(),\n          children: \"Simpan\"\n        })\n      })]\n    })]\n  });\n};\n\nexport default TableCalon;","map":null,"metadata":{},"sourceType":"module"}